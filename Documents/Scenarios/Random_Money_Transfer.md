Random Money Transfer
====

## Summary

### Purpose

#### Major Purpose

* How to variable update
* Check random generation
* How to initiate SI from SI
* How to manipulate text
* How to parse CEREScript and etc. from text
* How to inherit variable in HistoricalTable

#### Minor Purpose

* How RWVP affects to parallelism
* How RWVP Check works
* How Array with idx works
* How Loop works

### Scenario Definition

* Generate account randomly in progress
* Transfer random amount money with random password from randomly selected account A to randomly selected account B in progress

## Expected Result

### SpoolInstance

* Initiate Account generation & Money transfer SIs randomly before starting a simulation
* Initiate Account generation & Money transfer SIs randomly in progress

### Storage status

* In Vars
  * Account Names
    * At "$ID"
* In NHistoricalTable
  * Inherited
    * Every account's balance
      * At "Account-$ID"
  * Once
    * Transaction message
      * At "Transaction-${Counter}"

## Phase

### Initialize World

#### Initialize Variables

* NHistoricalTable
  * Account Balance
* NVariables
  * Account Balance
  * Account Password
  * Transaction Counter
* Dictionary
  * Account Name

### Generating Accounts

The account have only Name, Balance, and Password.
The account pops randomly in progress.

#### Initialize Account variables

* Account related variables
  * Account Name: Just for generating messages, Refers `Vars`
    * Place: `Dictionary`
    * ID: Selected from [1024,2048) randomly
    * Value Type: `StrValue`
    * Value: "Account-$ID"
  * Account Balance: Represent Account Balance as `IntValue`
    * Place: `NHistoricalTable`
      * To show account balance history
    * ID: "Account-$ID"
    * Value Type: `IntValue`
    * InheritType: Inherit
    * Value: `65536`
  * Account Password: Represent Account Password as `StrValue`
    * Place: `NVariables`

### Load Events

#### Initialize Transfer Event(Spool)

The Event is a single Spool.
The Event is randomly generated at the start.
The Event is randomly generated by Generator Event in progress.

##### Detail Behavior

* When the original and target account is not exist, the Event does nothing but leaves transaction message `"The original/target account Account-$ID does not exist"`
* When the password stored in the SI is wrong, the Event does nothing but leaves transaction message `"The password of original account Account-$ID does not match"`
* When the original account have not enough balance, the Event does nothing but leaves transaction message `"The original account Account-$ID does not have enough money"`
* When the original account have enough balance, then the Event
  * Subtract described amount from original balance
  * Add described amount to target balance
  * Leave transaction message "The amount $amount is moved from $OriginalAccount to $TargetAccount at Transaction $TransactionID" at "Transaction-$TransactionID"

##### Transfer Event structure

* Transfer Event-Spool
  * Spool ID: `1`
  * Spool Name: "Transfer"
  * Priority: `1`
  * ReadVP:
      [ AtNTime 0 "Account-$Arg1"
      , AtNTime 0 "Account-$Arg2"
      , AtNVars "Transaction Counter"]
  * WriteVP:
      [ AtNTime 0 "Account-$Arg1"
      , AtNTime 0 "Account-$Arg2"
      , AtNVars 0 "Transaction Counter"
      , AtNTime 0 "Transaction-$Counter"]
  * InitLocalNVars:
      [ ("From", StrValue "Account-$Arg1")
      , ("To", StrValue "Account-$Arg2")
      , ("TransferAmount", IntValue 100)
      , ("TransactionID", IntValue $Counter)
      ]


## Data

### CEREScript Precursor

#### Generate an Account

CRSInitVariable (VP AtDict (VII $AccountID)) (VP AtHere (VIV ))

#### Transfer Money

